---
title: "p8105_hw2_xz3312"
author: "Eric Zhang"
date: "2025-09-26"
output: github_document
---

```{r}
library(tidyverse)
library(readxl)
library(haven)
```
#Problem 1
##Let's import the dataset pols_month and make changes to it [problem 1 part 1]
```{r}
pols_month_df = 
  read.csv("fivethirtyeight_datasets/pols-month.csv", na=c("NA",".",""))

library(dplyr)
library(tidyr)

pols_month_clean_df = 
  read.csv("fivethirtyeight_datasets/pols-month.csv", na=c("NA",".","")) %>% 
  as_tibble() %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) %>% 
  mutate(
    month = factor(month.name[month], levels = month.name),
    president = if_else(prez_gop == 1, "gop", "dem")
  ) %>% 
  select(-prez_dem, -prez_gop)
```

##Let's import the dataset snp.csv and make similar changes to it [problem 1 part 2]
```{r}
snp_df =
  read.csv("fivethirtyeight_datasets/snp.csv", na=c("NA",".",""))

library(dplyr)
library(tidyr)

snp_clean_df =
    read.csv("fivethirtyeight_datasets/snp.csv", na=c("NA",".","")) %>%
  as_tibble() %>% 
  separate(date, into = c("month","day","year"), sep = "/", convert = TRUE) %>% 
  mutate(
    year = year + if_else(year>=50L, 1900L,2000L),
    month = factor(month.name[month], levels = month.name)
  ) %>% 
  relocate(year, month, day)
      
```

##Let's import and tidy the unemployment dataset so it can be merged with previous datasets [problem 1 part 3]
```{r}
unemployment_df =
   read.csv("fivethirtyeight_datasets/unemployment.csv", na=c("NA",".",""))

library(dplyr)
library(tidyr)
library(janitor)
library(stringr)

unemployment_clean_df <-
  read.csv("fivethirtyeight_datasets/unemployment.csv",
           na = c("NA", ".", "")) %>%
  as_tibble() %>%
  clean_names() %>%
  pivot_longer(
    cols = jan:dec,              # after clean_names(): jan, feb, ..., dec
    names_to = "month",
    values_to = "unemployment_percentage"
  ) %>%
  mutate(
    month = factor(
      str_to_title(month),       # "jan" -> "Jan"
      levels = month.abb,        # "Jan","Feb",...,"Dec"
      ordered = TRUE
    )
  ) %>%
  arrange(year, month)

pols2  <- pols_month_clean_df  %>% mutate(month = str_to_title(as.character(month)))
snp2   <- snp_clean_df         %>% mutate(month = str_to_title(as.character(month)))
unemp2 <- unemployment_clean_df %>% mutate(month = str_to_title(as.character(month)))

merged_df <- pols2 %>%
  left_join(snp2,  by = c("year", "month")) %>%
  left_join(unemp2, by = c("year", "month"))

```
The pols dataset gives information about the composition of the U.S. executive and legislative branches by month and year, and which party holds the office. Snp dataset contains monthly closing values of the stocks, which connects politics to market performance. Unemployment dataset gives unemployment percentage by month and year. I wish the unemployment dataset provided day of the month as well, even if percentage number is consistent; this would make the dataframe have less NA values.

#Problem 2
```{r}
library(readxl)
library(dplyr)
library(janitor)
library(lubridate)
mrtrashwheel_df = 
  read_excel("~/Desktop/p8105_homework_2/202409_trashwheel.xlsx", na=c("NA",".",""))


mrtrashwheel_df <- trashwheel_df %>%  clean_names()

mrtrashwheel_clean_df <- trashwheel_df %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(
    date = as.Date(as.character(date)),
    sports_balls = as.integer(round(sports_balls))
  )

mrtrashwheel_clean_df %>% 
  select(-x15,-x16)

```
##Do the same for professor trashwheel and gwynnda trashwheel data
```{r}
library(readxl)
library(dplyr)
library(janitor)
prof_trashwheel_df <- read_excel(
  path  = "~/Desktop/p8105_homework_2/202409_trashwheel.xlsx",
  sheet = "Professor Trash Wheel",   
  skip  = 1,                         
  na    = c("", "NA", "."),
) 

proftrashwheel_clean_df <- prof_trashwheel_df %>% 
  mutate(
    `Homes Powered*` = as.integer(round(`Homes Powered*`)) #rounded home powered to integer
  )

proftrashwheel_clean_df <- proftrashwheel_clean_df[-c(119, 120, 121), ] #I noticed row 119 to 121 had mostly NA values, so I removed them

gwynnda_trashwheel_df <- read_excel(
  path  = "~/Desktop/p8105_homework_2/202409_trashwheel.xlsx",
  sheet = "Gwynnda Trash Wheel",   
  skip  = 1,                         
  na    = c("", "NA", "."),
) 

gwynndatrashwheel_clean_df <- gwynnda_trashwheel_df %>% 
  mutate(
    `Homes Powered*` = as.integer(round(`Homes Powered*`)) #rounded home powered to integer
  )

gwynndatrashwheel_clean_df <- gwynndatrashwheel_clean_df[-c(264), ] #removed row 264 which is NA
  
```